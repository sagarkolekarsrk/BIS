                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        import React, { useState, useEffect } from "react";
import { get, patch ,post} from "axios";
import { useNavigate, useParams } from "react-router-dom";
import DatePicker  from "react-datepicker";  
import "react-datepicker/dist/react-datepicker.css";  
import './index.css'


function BookIssueDetails(props) {
	const initialState = {
		BookName: "",
		Language: "",
		BookType: "",
	    BookAuther: "",
		NoCopiesActual: "",
		NoCopiesCurrent: "",
		PublicationYear: "",
		BookCover: "",
		BookDiscription: "",
		BookStatus: "",
		ISBN: "",
			};

			//const bookIssueRecord = [];

            const bookIssueState = {
                BookInfoId: "",
                EmployeeInfoId: "",
                IssuedFrom: "",
                IssuedTO: "",
                ActualReturnDate: "",
                IssuedBy: "",
				};
	const [bookData, setCrud] = useState(initialState);
    // const [bookIssueData, setBookIssueData] = useState(bookIssueState);
    const [isDisabled, setIsDisabled] = useState(true);
    //const [isIssued, setIsIssued] = useState(true);
	const { id } = useParams();
	const navigate = useNavigate();
    const [startDate, setStartDate] = useState();
    const [endDate, setEndDate] = useState();
    const handleFromDate = startDate => {
		setStartDate(startDate);
		bookIssueData.IssuedFrom=startDate.toISOString().slice(0, 10);
	}
	
	const isWeekStart = (startDate) => {

		let days=startDate.getDay();
		const day = days;
		return day !== 0 && day !== 6;
	  };
	  const isWeekEnd = (endDate) => {

		let days=endDate.getDay();
		const day = days;
		return day !== 0 && day !== 6;
	  };
	const handleToDate = endDate => {

		setEndDate(endDate);
		bookIssueData.IssuedTO=endDate.toISOString().slice(0, 10);
		bookIssueData.BookInfoId=id;
		bookIssueData.EmployeeInfoId="2";
	}
	const [bookIssueData, setBookIssueData] = useState(bookIssueState);
	useEffect(
		function () {
			async function updateCrud() {
				try {
					const response = await get(`http://localhost:8081/api/books/${id}`);
					setCrud(response.data[0]);
					//navigate("/books/mylist");
					
				} catch (error) {
					console.log(error);
				}
			}
			updateCrud();
		},
		// eslint-disable-next-line react-hooks/exhaustive-deps
		[props]
	);

	function handleSubmit(event) {
    	const id=bookData.BookInfoId;
		event.preventDefault();
		async function issuedBook() {
			try {
				const response = await patch(`http://localhost:8081/api/books/${id}/status/notavailable`, bookData);
				navigate("/books/mylist");
				
			} catch (error) {
				console.log(error);
			}
		}
		issuedBook();
        saveIssuedBookInfo(event);
	}


    function saveIssuedBookInfo(event) {
       event.preventDefault();
		async function saveIssuedBook() {
			try {
				const response = await post("http://localhost:8081/api/books/issue",bookIssueData);
				navigate("/books/mylist");
				} catch (error) {
				console.log("error", error);
			}
		}
		saveIssuedBook();
	}




	function handleChange(event) {
		setCrud({ ...bookData, [event.target.name]: event.target.value });
        setBookIssueData({ ...bookIssueData, [event.target.name]: event.target.value });
		
	}

	function handleCancel() {
		// navigate(`/books/edit/${bookData.BookInfoId}`);
		navigate(`/books/mylist`);
	}

	return (
		<div className="container">
			
		<div className="row add_book " style={{ marginTop:"92px",background: "#ffff" }}>
			{/* <h1>Book : {bookData.BookName}</h1>
			<hr /> */}
			<form onSubmit={handleSubmit} className="col-md-8">
				<div className="row mb-2">
					<div className="form-group col-md-6" >
						<label>Name</label>
						<input
							name="BookName"
							type="text"
							required
							value={bookData.BookName}
							onChange={handleChange}
							className="form-control"
							disabled={isDisabled}
						/>
					</div>
					<div className="form-group col-md-6" disabled="true">
						<label>Language</label>
						<input
							name="Language"
							type="text"
							required
							value={bookData.Language}
							onChange={handleChange}
							className="form-control"
							disabled={isDisabled}
						/>
					</div>
				</div>
				<div className="row mb-2">
					<div className="form-group col-md-6" disabled="true">
						<label>Catagory</label>
						<input
							name="BookType"
							type="text"
							required
							value={bookData.BookType}
							onChange={handleChange}
							disabled={isDisabled}
							className="form-control"
						/>
					</div>
					<div className="form-group col-md-6" disabled="true">
						<label>Author</label>
						<input
							name="BookAuther"
							type="text"
							required
							value={bookData.BookAuther}
							onChange={handleChange}
							disabled={isDisabled}
							className="form-control"
						/>
					</div>
				</div>
				
				
				<div className="form-group mb-2" disabled="true">
					<label>Publication Year</label>
					<input
						name="PublicationYear"
						type="text"
						required
						value={bookData.PublicationYear}
						onChange={handleChange}
                        disabled={isDisabled}
						className="form-control"
					/>
				</div>
				
				<div className="row mb-2">
					<div className="form-group col-md-6" disabled="true">
						<label>ISBN</label>
						<input
							name="ISBN"
							type="text"
							required
							value={bookData.ISBN}
							onChange={handleChange}
							disabled={isDisabled}
							className="form-control"
						/>
					</div>
					<div className="form-group col-md-6">
						<label>Issued By</label>
						<input
							name="IssuedBy"
							type="text"
							required
							value={bookIssueData.IssuedBy}
								
							onChange={handleChange}
							className="form-control"
						/>
					</div>
				</div>
				<div className="row mb-2">
			<div className="col-md-6">
				<DatePicker
					selected={startDate}
					dateFormat="dd-MM-yyyy"
					minDate={new Date()}
					filterDate={isWeekStart}
					className="mt-3 date_picker col-12"
					//onChange={(date) => setStartDate(date)}
					onChange={handleFromDate}
					placeholderText="Select Start Date"
					selectsStart
					startDate={startDate}
					endDate={endDate}

				/>
				</div>

				<div className="col-md-6">
				<DatePicker
					selected={endDate}
					dateFormat="dd-MM-yyyy"
					filterDate={isWeekStart}
					className="mt-3 date_picker col-12"
				//  onChange={(date) => setEndDate(date)}
				onChange={handleToDate}
					placeholderText="Select End Date"
					selectsEnd
					startDate={startDate}
					endDate={endDate}
					minDate={startDate}
				/>
			</div>
			
		</div>
				<div className="form-group mb-2" disabled="true">
					<label>Description</label>
					<textarea
						name="BookDiscription"
						row="5"
						value={bookData.BookDiscription}
						onChange={handleChange}
                        disabled={isDisabled}
						className="form-control"
					/>
				</div>
                <div className="row">
			<div className=" col-md-12 mt-4">
					
					<button
						type="button"
						onClick={handleCancel}
						className="btn cancel_btn text-white font-13 px-4 float-end" style={{ width:"163px"}}
					>
						Cancel
					</button>
					<button type="submit" className="btn issue_btn text-white font-13 px-4 float-end" style={{ width:"163px"}}>
						Issue
					</button>
				</div>
			</div>
				
	
			</form>

			<div className="col-md-4"  style={{ marginTop:"58px" }}>
				<img src={process.env.PUBLIC_URL + "/issuebook.jpg"} Width="372px"/>
			</div>
		</div>
		
		</div>
	);
		
		
}

export default BookIssueDetails;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           